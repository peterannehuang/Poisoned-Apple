# Poisoned-Apple
Poison Apple Regression Unit Testing Framework

這是一個測試架構，基於業務方面的測試，來產生自動化執行的單元測試案例。
基本概念如下：
1. 基於AOP收集業務方面測試的執行過程。來源可能基於UAT或SIT或其他具有業務意涵的測試。收集的內容最少為相關Method的Input跟Output，但更進一步，也可收集IO等其他資訊。
並將所收集的內容，按照測試案例跟執行順序等，記錄到資料庫或是檔案中。
2. 基於所收集到的資訊，產生對應的UT代碼，部分元件經過(人的)分析後，需改用模擬(Mock)元件，尤其是該元件需整合其他模組或系統時。
產生此UT代碼時，需確保相關測試案例，可在單元測試階段執行。至少要在開發完畢，從開發環境搬移到測試環境前，即可執行。最好是在開發環境上就可執行。
PS. 產生UT代碼是為了增加可讀性，以利當測試案例執行失敗時，開發者可以容易找到失敗點。

此架構的目的如下：
1. 提早業務回歸測試的時間點，從在UAT或SIT時執行，提早到開發中或是開發轉移到測試時。
2. 在軟體或服務持續修改的情形，確保相關元件，可持續提供之前已驗證過的業務功能；以避免改A錯B的情形發生。
3. 降低改A錯B時，錯誤來源的分析。
PS. 一般的SIT/UAT回歸測試案例，涉及大量元件的執行。當測試結果不正確時，會需要大量資深人力查看問題點。

此架構的延伸目的有：
1. 用於收集UI/UX等前端系統上傳回Server的資訊，並與UI/UX的自動化測試工具結合，產生UI/UX的特定回歸測試案例。這些案例用來驗證UI/UX上傳回Server的資訊，在特定輸入條件下，抱持一定的內容與格式。
PS. UI/UX上傳值是一種改A錯B的常見原因。

此架構不能用於下列目的：
1. 取代單元測試或是用於產生(基於技術或設計的)單元測試案例。
2. 用於驗證新功能或功能修改部分是否正確。故，修改此架構所產生的測試案例，以符合新功能或功能修改，是不當使用。
PS. 此架構僅用來進行回歸測試，所有新功能跟功能修改，都應按照一般軟體測試流程或架構進行相關測試。
PS. 針對新功能或功能修改，應在完成業務方面測試時，重新收集並產生新的UT代碼。之前所產生的相關UT代碼，應直接廢除，而非修改。

使用此架構時，應了解下列內容：
1. 此架構未保證原有功能在修改後，沒有問題。僅保證在修改後，之前執行的業務測試案例，具有相同的執行結果。
2. 案例執行後，比對結果不正確，不等於此元件發生錯誤(Defect)。僅表示與之前有不同的執行結果；是否為錯誤，需相關人員查看測試案例內容跟相關代碼來釐清。
PS. 一種可能發生的情境是，之前業務相關測試時，兩個元件都有錯誤，但錯誤剛好結合出正確的結果。在其中一個元件修正後，該元件會發生案例比對錯誤，但是原因是該案例不正確。應請相關人員重新測試相關業務案例，重新確認測試結果是否正確。

此架構在Java SE8(含之後)，具有下列組件：
PS. 部分組件或功能，在Java SE7(含之前)可能無法使用。主要是在取得method變數的名稱，需要使用Java SE8之後(含)的版本。
1. 基於AOP的收集器：至少支援AspectJ AOP跟Spring AOP。這些收集器可以被繼承或是複用，以利不同案子下，指定應收集的Class跟Method(或Constructor)。
PS. 支援Spring SOP是因為在部分使用Spring的案子中，使用AspectJ會比較麻煩。
2. 將Java Object轉換成XML or JSON格式，並儲存到檔案或資料庫。
PS. 原則上可序列化(Serializable)的Object都可以轉換成XML或JSON，但此組件不只是處理可序列化的Object，還包含將所有Object中可序列化的Fields儲存起來的功能。
3. 將儲存的資料轉換成Junit4或Junit5或TestNG的測試代碼。並且允許在轉換時，使用預先定義好的模擬(Mock)元件，或是針對無法轉換的部分提供相關的異常報表跟建議。
4. 一個可以基於已儲存的資料(如檔案或資料庫)，直接可執行的Junit4或Junit5或TestNG測試代碼。
PS. 組件4跟組件3的目的不同，組件3是正式執行時使用，組件4是在測試小組在導入此架構時，用於快速測試跟設計模擬元件用。
